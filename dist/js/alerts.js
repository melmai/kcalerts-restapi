(()=>{function t(t,e){const o=Math.round((new Date).getTime()/1e3),r=n(t),s=n(e);return r===s?r:e<o?`${r} until further notice`:`${r} to ${s}`}function e(t){if(""===t)return"";let e="";return e=t.replaceAll(/NB/g,"Northbound"),e=e.replaceAll(/SB/g,"Southbound"),e=e.replaceAll(/EB/g,"Eastbound"),e=e.replaceAll(/WB/g,"Westbound"),e=e.replaceAll(/ Ave?\b/gm," Avenue"),e=e.replaceAll(/ St\b/gm," Street"),e=e.replaceAll(/ Pl\b/gm," Place"),e=e.replaceAll(/ Rd\b/gm," Road"),e=e.replaceAll(/ Pkwy\b/gm," Parkway"),e=e.replaceAll(/ Blvd\b/gm," Boulevard"),e=e.replaceAll(/ Lk\b/gm," Lake"),e=e.replaceAll(/ Samm\b/gm," Sammamish"),e}function n(t){return new Date(1e3*t).toLocaleDateString()}function o(){const t=document.getElementsByClassName("tab-btn");for(bttn of t)bttn.removeAttribute("class","selected"),bttn.setAttribute("class","tab-btn")}function r(t="",e=""){const n=document.getElementById("accordion");let r;""===t?n.removeAttribute("class","ongoing upcoming"):n.removeAttribute("class",e),n.setAttribute("class",`accordion accordion-flush ${t}`),o(),r=""===t?document.getElementById("reset"):document.getElementById(`${t}-filter`),r.setAttribute("class","tab-btn selected")}function s(t=!1){t&&document.getElementById("clear-search").setAttribute("style","visibility: visible;");const e=document.getElementById("route-search").value.toLowerCase(),n=document.getElementsByClassName("advisory-block");for(route of n)route.getAttribute("data-route").toLowerCase().includes(e)?route.setAttribute("style","display:block;"):route.setAttribute("style","display:none;")}function a(){document.getElementById("clear-search").setAttribute("style","visibility: hidden;"),document.getElementById("route-search").value="",s(!1)}function c(t){const e=t.target.nextSibling;"none"===e.style.display?e.style.display="block":e.style.display="none","View details"===t.target.textContent?t.target.textContent="Hide details":t.target.textContent="View details"}window.addEventListener("DOMContentLoaded",(function(){const n=document.getElementById("kcalert-accordion");Promise.all([fetch("../../json/alerts20221207.json").then((t=>t.json())),fetch("../../json/routes.json").then((t=>t.json()))]).then((o=>{const l=function(t){let e=[];return t.forEach((t=>{const n=function(t,e){return[...new Set(t.map((t=>t.route_id)))]}(t.affected_services.services);e.push({route_ids:n,alert:t,status:t.alert_lifecycle})})),e}(o[0].alerts),i=(u=function(t,e){let n=e;return t.forEach((t=>{t.route_ids.forEach((e=>{n.forEach((n=>{e===n.route_id&&(n.alerts?n.alerts=[...n.alerts,t.alert]:(n.alerts=[],n.alerts[0]=t.alert),n.status=function(t,e={ongoing:0,upcoming:0}){let n=e;return t.includes("Ongoing")||"New"===t?n.ongoing=n.ongoing+1:n.upcoming=n.upcoming+1,n}(t.status,n.status))}))}))})),e}(l,function(t){let e="",n=[];return t.forEach((t=>{"102698"===t.route_id?e=t:n.push(t)})),[...n,e]}(o[1].mode[1].route)),u.filter((t=>t.alerts)));var u;let d=new DocumentFragment;i.forEach(((n,o)=>{d.append(function(n,o){let r=new DocumentFragment;const s=function(t){return"Duvall-Monroe Shuttle"===t?t:t.charAt(0).match(/[a-z]/i)?`RapidRide ${t}`:function(t){const e=parseInt(t);return e>=500&&e<600}(t)?`ST ${t}`:function(t){const e=parseInt(t);return 204===e||224===e||630===e||631===e||e>=901&&e<=930}(t)?`DART ${t}`:`Route ${t}`}(n.route_name),a=document.createElement("div");a.id=n.route_id;const l=n.status.ongoing?"ongoing":"",i=n.status.upcoming?"upcoming":"";a.setAttribute("class",`toggle advisory-block ${l} ${i}`),a.setAttribute("data-route",s);const u=document.createElement("input");u.setAttribute("id",`toggle-advisory-${n.route_id}`),u.setAttribute("type","checkbox"),u.setAttribute("name",`toggle-advisory-${n.route_id}`),u.setAttribute("aria-hidden","true");const d=document.createElement("label");d.setAttribute("class","toggle-head advisory-block-title with-description"),d.setAttribute("for",`toggle-advisory-${n.route_id}`);const m=document.createElement("h2");m.setAttribute("class","accordion-title"),m.textContent=s;const g=document.createElement("div");let p,b;g.setAttribute("class","route-status"),g.setAttribute("aria-hidden","true"),n.status.ongoing>0&&(p=document.createElement("span"),p.setAttribute("class","ongoing"),p.textContent=n.status.ongoing),n.status.upcoming>0&&(b=document.createElement("span"),b.setAttribute("class","upcoming"),b.textContent=n.status.upcoming),g.append(p||"",b||""),d.append(m,g),a.append(u,d);const f=document.createElement("div");return f.setAttribute("class","toggle-inner"),n.alerts.forEach(((n,o)=>{f.append(function(n,o){const r=document.createElement("div");r.setAttribute("class",`advisory-content ${function(t){let e;switch(t){case"Trip Cancelation":case"Suspension":e="error";break;case"Trip Restoration":e="task_alt";break;case"Stop Closure":e="dangerous";break;case"Multi-route Reroute":case"Single Route Reroute":e="alt_route";break;case"Delay of Service":e="timer";break;case"Emergency Snow Network":case"Snow Route":e="ac_unit";break;default:e="warning"}return e}(n.effect_name)}`);const s=document.createElement("h4");s.setAttribute("class","advisory-type"),s.textContent=function(t){let e="";return e=t.replaceAll(/ESN\b/gm," Emergency Snow Network"),e}(n.effect_name);const a=document.createElement("span");a.setAttribute("class",`alert-status ${status.toLowerCase()}`),a.append(status),s.append(a);const l=document.createElement("p");l.setAttribute("class","advisory-title"),l.textContent=e(n.header_text);let i="";n.description_text&&(i=document.createElement("p"),i.textContent=e(n.description_text),i.setAttribute("class","alert-description"),i.setAttribute("style","display:none;"));let u="";n.description_text&&(u=document.createElement("a"),u.setAttribute("class","expand-link"),u.addEventListener("click",c),u.textContent="View details");const d=document.createElement("p");d.textContent=`Cause: ${n.cause}`,d.setAttribute("class","cause");let m="N/A";m=document.createElement("p"),n.effect_periods.length>1?(m.textContent=function(e){let n="Effective Dates: ";for(let o=0;o<e.length;o++)o===e.length-1?n+=`and ${t(e[o].effect_start,e[o].effect_end)}`:n+=`${t(e[o].effect_start,e[o].effect_end)}, `;return n}(n.effect_periods),m.setAttribute("class","advisory-dates")):1===n.effect_periods.length&&(m.textContent=`Effective Dates: ${t(n.effect_periods[0].effect_start,n.effect_periods[0].effect_end)}`,m.setAttribute("class","advisory-dates"));const g=document.createElement("p");return g.setAttribute("class","alert-footer"),g.textContent=`Alert ID: ${n.alert_id}, Last Updated: ${t(n.last_modified_dt,n.last_modified_dt)}`,r.append(s,l,u,i,d,m,g),r}(n))})),a.append(f),r.append(a),r}(n))})),n.append(d),document.getElementById("reset").addEventListener("click",(()=>r())),document.getElementById("ongoing-filter").addEventListener("click",(()=>r("ongoing","upcoming"))),document.getElementById("upcoming-filter").addEventListener("click",(()=>r("upcoming","ongoing"))),document.getElementById("route-search").addEventListener("keyup",(()=>s(!0))),document.getElementById("clear-search").addEventListener("click",a),new ResizeObserver((function(t){let e=t[0].contentRect;const o=document.getElementById("no-alerts-msg");0===e.height?(o.setAttribute("style","display: block;"),n.setAttribute("style","border-color: transparent;")):(o.setAttribute("style","display: none;"),n.setAttribute("style","border-color: #eee;"))})).observe(n)}))}))})();