(()=>{"use strict";var t="https://kcm-api.ibi-transit.com/developer/api/v2",e="3QxRRLWBsUAZbfT62GEB2Q";function n(t){return function(t){if(Array.isArray(t))return r(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function o(t){for(var e="Effective Dates: ",n=0;n<t.length;n++)n===t.length-1?e+="and ".concat(a(t[n].effect_start,t[n].effect_end)):e+="".concat(a(t[n].effect_start,t[n].effect_end),", ");return e}function a(t,e){var n=Math.round((new Date).getTime()/1e3),r=u(t),o=u(e);return r===o?r:e<n?"".concat(r," until further notice"):"".concat(r," to ").concat(o)}function c(t){var e;switch(t){case"Trip Cancelation":case"Suspension":e="error";break;case"Trip Restoration":e="task_alt";break;case"Stop Closure":e="dangerous";break;case"Multi-route Reroute":case"Single Route Reroute":e="alt_route";break;case"Delay of Service":e="timer";break;case"Emergency Snow Network":case"Snow Routes":case"Snow Route":e="ac_unit";break;default:e="warning"}return e}function i(t){return""===t?"":t.replaceAll(/NB/g,"Northbound").replaceAll(/SB/g,"Southbound").replaceAll(/EB/g,"Eastbound").replaceAll(/WB/g,"Westbound").replaceAll(/ Ave?\b/gm," Avenue").replaceAll(/ St\b/gm," Street").replaceAll(/ Pl\b/gm," Place").replaceAll(/ Rd\b/gm," Road").replaceAll(/ Pkwy\b/gm," Parkway").replaceAll(/ Blvd\b/gm," Boulevard").replaceAll(/ Lk\b/gm," Lake").replaceAll(/ Samm\b/gm," Sammamish")}function s(t){return"New"===t||t.includes("Ongoing")?"ongoing":"upcoming"}function u(t){return new Date(1e3*t).toLocaleDateString()}function l(t,e){var n=document.createElement("span");return"snow"!==t?(n.setAttribute("class",t),n.textContent=e):(n.setAttribute("class","snow-icon material-symbols-outlined"),n.textContent="ac_unit"),n}function d(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return m(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,i=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return c=t.done,t},e:function(t){i=!0,a=t},f:function(){try{c||null==n.return||n.return()}finally{if(i)throw a}}}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function f(){var t,e=d(document.getElementsByClassName("tab-btn"));try{for(e.s();!(t=e.n()).done;){var n=t.value;n.removeAttribute("class","selected"),n.setAttribute("class","tab-btn")}}catch(t){e.e(t)}finally{e.f()}}function g(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=document.getElementById("kcalert-accordion");""===t?n.removeAttribute("class","ongoing upcoming"):n.removeAttribute("class",e),n.setAttribute("class","accordion accordion-flush ".concat(t)),n.scrollIntoView(),f(),(""===t?document.getElementById("reset"):document.getElementById("".concat(t,"-filter"))).setAttribute("class","tab-btn selected")}function p(t){var e=t.target.nextSibling;"none"===e.style.display?e.style.display="block":e.style.display="none","Show details"===t.target.textContent?t.target.textContent="Hide details":t.target.textContent="Show details"}function v(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(t){var e=document.getElementById("clear-search");e.setAttribute("style","visibility: visible;")}var n,r=document.getElementById("route-search").value.toLowerCase(),o=document.getElementsByClassName("advisory-block"),a=d(o);try{for(a.s();!(n=a.n()).done;){var c=n.value,i=c.getAttribute("data-route").toLowerCase();i.includes(r)?c.setAttribute("style","display:block;"):c.setAttribute("style","display:none;")}}catch(t){a.e(t)}finally{a.f()}document.getElementById("alerts-container").scrollIntoView({behavior:"smooth",block:"start"})}function b(){document.getElementById("clear-search").setAttribute("style","visibility: hidden;"),document.getElementById("route-search").value="",v(!1)}function y(t){var e=document.createElement("p"),n=document.createElement("a");return n.setAttribute("href",t),n.setAttribute("target","_blank"),n.setAttribute("class","advisory-link"),t.includes("drive.google.com")?(n.textContent="View map",n.setAttribute("class","advisory-link link-icon-picture_as_pdf")):t.includes("kingcountymetro.blog")?(n.textContent="View Blog Post",n.setAttribute("class","advisory-link link-icon-outbound")):t.includes("tripplanner.kingcounty.gov")?n.textContent="View next departures":t.includes("/metro/routes-and-service/schedules-and-maps")?n.textContent="View route schedule":n.textContent="More info",e.append(n),e}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function A(){var t=document.getElementById("kcalert-accordion");Promise.all([fetch("/static/json/alerts20221207.json").then((function(t){return t.json()})),fetch("/static/json/routes.json").then((function(t){return t.json()}))]).then((function(e){var r=function(t){var e=[];return t.forEach((function(t){var r=function(t,e){return n(new Set(t.map((function(t){return t.route_id}))))}(t.affected_services.services);e.push({route_ids:r,alert:t,status:t.alert_lifecycle})})),e}(e[0].alerts),u=function(t){console.log(t);var e=[],n=[];return t.forEach((function(t){"102698"===t.route_id||"102699"===t.route_id||"Trailhead Direct Mt. Si"===t.route_name?e.push(t):n.push(t)})),[].concat(n,e)}(e[1].mode[1].route);console.log(e[1]);var d,m=function(t){return t.filter((function(t){return t.alerts}))}(function(t,e){var n=e;return t.forEach((function(t){t.route_ids.forEach((function(e){n.forEach((function(n){var r;e===n.route_id&&(n.alerts?n.alerts=[].concat(function(t){if(Array.isArray(t))return h(t)}(r=n.alerts)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(r)||function(t,e){if(t){if("string"==typeof t)return h(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(t,e):void 0}}(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[t.alert]):(n.alerts=[],n.alerts[0]=t.alert),n.status=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ongoing:0,upcoming:0},n=e;return t.includes("Ongoing")||"New"===t?n.ongoing=n.ongoing+1:n.upcoming=n.upcoming+1,n}(t.status,n.status),n.is_snow=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.toLowerCase().includes("snow")?e+1:e}(t.alert.effect_name,n.is_snow))}))}))})),e}(r,u)),f=new DocumentFragment;m.forEach((function(t,e){f.append(function(t,e){var n=new DocumentFragment,r=function(t){return"Duvall-Monroe Shuttle"===t||"Trailhead Direct Mt. Si"===t?t:"629"===t?"SVT Shuttle":t.charAt(0).match(/[a-z]/i)?"RapidRide ".concat(t):function(t){var e=parseInt(t);return e>=500&&e<600}(t)?"ST ".concat(t):function(t){var e=parseInt(t);return 204===e||224===e||630===e||631===e||e>=901&&e<=930}(t)?"DART ".concat(t):"Route ".concat(t)}(t.route_name),u=document.createElement("div");u.id=t.route_id;var d=t.status.ongoing?"ongoing":"",m=t.status.upcoming?"upcoming":"";u.setAttribute("class","toggle advisory-block ".concat(d," ").concat(m)),u.setAttribute("data-route",r);var f=document.createElement("input");f.setAttribute("id","toggle-advisory-".concat(t.route_id)),f.setAttribute("type","checkbox"),f.setAttribute("name","toggle-advisory-".concat(t.route_id)),f.setAttribute("aria-hidden","true");var g=document.createElement("label");g.setAttribute("class","toggle-head advisory-block-title with-description"),g.setAttribute("for","toggle-advisory-".concat(t.route_id));var v=document.createElement("h2");v.setAttribute("class","accordion-title"),v.textContent=r;var b,h,A,E=document.createElement("div");E.setAttribute("class","route-status"),E.setAttribute("aria-hidden","true"),t.is_snow>0&&(b=l("snow",t.is_snow)),t.status.ongoing>0&&(h=l("ongoing",t.status.ongoing)),t.status.upcoming>0&&(A=l("upcoming",t.status.upcoming)),E.append(b||"",h||"",A||""),g.append(v,E),u.append(f,g);var _=document.createElement("div");return _.setAttribute("class","toggle-inner"),t.alerts.forEach((function(t,e){_.append(function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=document.createElement("div");n.setAttribute("class","advisory-panel");var r=document.createElement("span");r.setAttribute("class","advisory-icon ".concat(c(t.effect_name))),r.setAttribute("aria-hidden","true"),r.textContent=c(t.effect_name);var u=document.createElement("div");u.setAttribute("class","advisory-content");var l=document.createElement("div");l.setAttribute("class","advisory-title-container");var d=document.createElement("h3");d.setAttribute("class","advisory-type"),d.textContent=t.effect_name;var m=document.createElement("span");m.setAttribute("class","advisory-status ".concat(s(t.alert_lifecycle))),m.textContent=s(t.alert_lifecycle),l.append(d,m);var f=document.createElement("p");f.setAttribute("class","advisory-title"),f.textContent=i(t.header_text);var g="",v=t.url;!e&&v&&v.includes("schedules-and-maps")&&(v="");var b="";t.description_text?((g=document.createElement("p")).textContent=i(t.description_text),g.setAttribute("class","alert-description"),g.setAttribute("style","display:none;"),v&&g.append(y(v))):v&&(b=y(v));var h="";t.description_text&&((h=document.createElement("a")).setAttribute("class","expand-link"),h.addEventListener("click",p),h.textContent="Show details");var A="";t.cause_name&&((A=document.createElement("p")).textContent="Cause: ".concat(t.cause_name),A.setAttribute("class","cause"));var E=document.createElement("p");E.setAttribute("class","advisory-dates"),t.effect_periods.length>1?E.textContent=o(t.effect_periods):1===t.effect_periods.length&&(E.textContent="Effective Dates: ".concat(a(t.effect_periods[0].effect_start,t.effect_periods[0].effect_end)));var _=document.createElement("p");return _.setAttribute("class","alert-footer"),_.textContent="Alert ID: ".concat(t.alert_id,", Last Updated: ").concat(a(t.last_modified_dt,t.last_modified_dt)),u.append(l,f,h,g,b,A,E,_),n.append(r,u),n}(t))})),u.append(_),n.append(u),n}(t))})),t.append(f),d=t,document.getElementById("reset").addEventListener("click",(function(){return g()})),document.getElementById("ongoing-filter").addEventListener("click",(function(){return g("ongoing","upcoming")})),document.getElementById("upcoming-filter").addEventListener("click",(function(){return g("upcoming","ongoing")})),document.getElementById("route-search").addEventListener("keyup",(function(){return v(!0)})),document.getElementById("clear-search").addEventListener("click",b),function(t){new ResizeObserver((function(e){var n=e[0].contentRect,r=document.getElementById("no-alerts-msg");0===n.height?(r.setAttribute("style","display: block;"),t.setAttribute("style","border-color: transparent;")):(r.setAttribute("style","display: none;"),t.setAttribute("style","border-color: #eee;"))})).observe(t)}(d)})).catch((function(t){console.log("error with create fxn",t)}))}"../static/json/route/".concat("007-271",".json"),"".concat(t,"/routes?api_key=").concat(e,"&format=json"),"".concat(t,"/alerts?api_key=").concat(e,"&format=json"),"".concat(t,"/alertsbyroute?api_key=").concat(e,"&route="),"loading"!==document.readyState?A():window.addEventListener("DOMContentLoaded",A)})();